(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{257:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"vuex学习笔记"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vuex学习笔记"}},[t._v("#")]),t._v(" vuex学习笔记")]),t._v(" "),s("p",[t._v("最近项目中用到了vuex不得不重新看一遍vuex的文档,照着文档上的案例自己做了一遍,以下是自己探索留下的足迹,\n自己很喜欢这种在一个案例上不断的添加新的东西或者重构的感觉,这种感觉很像自己一步步从自己的舒适区跨向自己的能力边界之外的感觉,而在一个示例上不断修改,会有一个弊端就是,你不知道你的思路如何从原始的A点经过了无数的步骤,\n到达了z点,借助github这种强大的commit可以将自己的思路不断的commit打下一个标签(或类比的说是设置一个游戏存档),\n以便于以后的自己,能沿着自己此时此刻的思路进行回溯,这是我想起了《糖果屋》(又译《汉泽尔与格莱特》)的故事,\n为自己的更深入思考洒下一些面包屑,避免未来的我再次迷失在诸多文档之中")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/a7ad80725c60405940951eefd52d645d1cd9052e",target:"_blank",rel:"noopener noreferrer"}},[t._v("feat: 在网页中使用vuex 增加数字大小 · macheng2017/review-vue@a7ad807"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/df053245ef780e6c2283ad78f710d70053ef43af",target:"_blank",rel:"noopener noreferrer"}},[t._v("feat: 对经常使用webpack构建的同学们来说,这里有些奇怪,为什么没有使用import导入就可以直接使用Vue以及Vuex? · macheng2017/review-vue@df05324"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/56db87d20cc8678e2f370177a33b5a7cab08e9a7",target:"_blank",rel:"noopener noreferrer"}},[t._v("refactor:封装一个Counter组件 · macheng2017/review-vue@56db87d"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/59ad44498fe57e638aaa082fce22b44611959922",target:"_blank",rel:"noopener noreferrer"}},[t._v("refactor:通过在根实例中注册 store 选项，该 store 实例会注入到根组件下的所有子组件中，且子组件能通过 this.$s… · macheng2017/review-vue@59ad444"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/8da86dd343377fa91246a9fb00c39899490d5812",target:"_blank",rel:"noopener noreferrer"}},[t._v("refactor:使用mapState辅助函数 · macheng2017/review-vue@8da86dd"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/402f94e734640218418c3cb788e3ba996768b18a",target:"_blank",rel:"noopener noreferrer"}},[t._v("refactor:使用mapState辅助函数,添加一些扩展 · macheng2017/review-vue@402f94e"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/f9f7e150288056c2c192965b6dc928d2354f73fa",target:"_blank",rel:"noopener noreferrer"}},[t._v("refactor:使用mapState辅助函数,添加一些扩展 · macheng2017/review-vue@f9f7e15"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/9ee4023d56fe34e18cd36a1caf0914b685bf1619",target:"_blank",rel:"noopener noreferrer"}},[t._v("refactor:映射 this.count 为 store.state.count · macheng2017/review-vue@9ee4023"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/57fdc148b698b3ea10532530e0d38963604865ba",target:"_blank",rel:"noopener noreferrer"}},[t._v("refactor:使用对象展开运算符将此对象混入到外部对象中 · macheng2017/review-vue@57fdc14"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/c6aa401ff28d82fb7055586a0399f41a267d7b69",target:"_blank",rel:"noopener noreferrer"}},[t._v("add:使用Getter从 store 中的 state 中派生出一些状态 · macheng2017/review-vue@c6aa401"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/654c1f9031bfa884e9e35f35371385e3c922b7de",target:"_blank",rel:"noopener noreferrer"}},[t._v("add:Getter 也可以接受其他 getter 作为第二个参数： · macheng2017/review-vue@654c1f9"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/a75dffcbd8334967a1e9705cec5e6576c137e704",target:"_blank",rel:"noopener noreferrer"}},[t._v("add:Getter 也可以接受其他 getter 作为第二个参数： · macheng2017/review-vue@a75dffc"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/8ed170082f4f2fa9ccb922bc8422a39c161ca791",target:"_blank",rel:"noopener noreferrer"}},[t._v("add:Getter 在组件中使用 · macheng2017/review-vue@8ed1700"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/b2a3f3998a7229bb252e94e5cf2bf1a71b2718a9",target:"_blank",rel:"noopener noreferrer"}},[t._v("add:Getter 通过方法访问 · macheng2017/review-vue@b2a3f39"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/563eaf0f5f109154020ddb3753a51f3819e3b4f3",target:"_blank",rel:"noopener noreferrer"}},[t._v("add:mapGetters 辅助函数 · macheng2017/review-vue@563eaf0"),s("OutboundLink")],1)])]),t._v(" "),s("h3",{attrs:{id:"mutation-需遵守-vue-的响应规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mutation-需遵守-vue-的响应规则"}},[t._v("#")]),t._v(" Mutation 需遵守 Vue 的响应规则")]),t._v(" "),s("p",[t._v("既然 Vuex 的 store 中的状态是响应式的，那么当我们变更状态时，监视状态的 Vue 组件也会自动更新。这也意味着 Vuex 中的 mutation 也需要与使用 Vue 一样遵守一些注意事项：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("最好提前在你的 store 中初始化好所有所需属性。")])]),t._v(" "),s("li",[s("p",[t._v("当需要在对象上添加新属性时，你应该")])])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("使用 Vue.set(obj, 'newProp', 123), 或者")])]),t._v(" "),s("li",[s("p",[t._v("以新对象替换老对象。例如，利用对象展开运算符我们可以这样写：")])])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("obj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newProp"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/0ceefacb66cb1fbafb0f7885b8b1fe866f4ec2cd",target:"_blank",rel:"noopener noreferrer"}},[t._v("refactor:你可以向 store.commit 传入额外的参数，即 mutation 的 载荷（payload）： · macheng2017/review-vue@0ceefac"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/c31e98566c84f55d4a35e1a0222abe7c180808a5",target:"_blank",rel:"noopener noreferrer"}},[t._v("refactor:在大多数情况下，载荷应该是一个对象，这样可以包含多个字段并且记录的 mutation 会更易读： · macheng2017/review-vue@c31e985"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/fcb2ffda1a679ac7ebb9b9f5f5e30fbccde85f60",target:"_blank",rel:"noopener noreferrer"}},[t._v("refactor:对象风格的提交方式 · macheng2017/review-vue@fcb2ffd"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/9695a965906fd89af47e5b2fe1756bedd651c590",target:"_blank",rel:"noopener noreferrer"}},[t._v("refactor:使用mapMutations · macheng2017/review-vue@9695a96"),s("OutboundLink")],1)])]),t._v(" "),s("h3",{attrs:{id:"mutation-必须是同步函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mutation-必须是同步函数"}},[t._v("#")]),t._v(" Mutation 必须是同步函数")]),t._v(" "),s("p",[t._v("一条重要的原则就是要记住 mutation 必须是同步函数")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://vuex.vuejs.org/zh/guide/mutations.html#mutation-%E9%9C%80%E9%81%B5%E5%AE%88-vue-%E7%9A%84%E5%93%8D%E5%BA%94%E8%A7%84%E5%88%99",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mutation | Vuex"),s("OutboundLink")],1)])]),t._v(" "),s("h3",{attrs:{id:"action"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#action"}},[t._v("#")]),t._v(" Action")]),t._v(" "),s("p",[t._v("Action 类似于 mutation，不同在于：")]),t._v(" "),s("ul",[s("li",[t._v("Action 提交的是 mutation，而不是直接变更状态。")]),t._v(" "),s("li",[t._v("Action 可以包含任意异步操作。")])]),t._v(" "),s("h4",{attrs:{id:"提供两个action真实的案例-分别是登录和获取用户信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#提供两个action真实的案例-分别是登录和获取用户信息"}},[t._v("#")]),t._v(" 提供两个action真实的案例,分别是登录和获取用户信息")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" actions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// user login")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("login")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" commit "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" userInfo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" userInfo\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("login")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("trim")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" password "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("response")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response\n        console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SET_TOKEN'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("token"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setToken")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("token"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// get user info")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getInfo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" commit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getInfo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("token"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("response")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Verification failed, please Login again.'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" roles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" avatar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" introduction "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// console.log('getInfo data:', data)")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// console.log('getInfo roles:', roles)")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// roles must be a non-empty array")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("roles "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" roles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'getInfo: roles must be a non-null array!'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SET_ROLES'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" roles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SET_NAME'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SET_AVATAR'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" avatar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SET_INTRODUCTION'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" introduction"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/crm-zbx-admin/commit/a16582859a2b115d15e7d988cb23921d7798b69a",target:"_blank",rel:"noopener noreferrer"}},[t._v("feat:使用vuex之后出现新的问题: 在父组件中使用$refs调用子组件中的校验isValidate后没有返回值,父组件的before… · macheng2017/crm-zbx-admin@a165828"),s("OutboundLink")],1)])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 标签切换之前调用的钩子,用于校验表单 after success并发送action到vuex")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("beforeSwitch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a hook '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$refs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tabInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isValidate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$refs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tabInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isValidate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// validate form data")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isValidate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$refs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baseInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("validate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("valid")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'baseInfo'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" valid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("valid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 校验通过则提交到store")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// this.$store.commit('tabForm/SET_BASE_INFO', this.baseInfo)")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$store"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tabForm/changeForm'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baseInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h5",{attrs:{id:"这里有个问题-set方法一直都不能正常工作-猜测是baseinfo是一个对象-如果是一个单属性值应该可以工作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#这里有个问题-set方法一直都不能正常工作-猜测是baseinfo是一个对象-如果是一个单属性值应该可以工作"}},[t._v("#")]),t._v(" 这里有个问题: set方法一直都不能正常工作,猜测是baseInfo是一个对象,如果是一个单属性值应该可以工作")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  computed"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里有个问题: set方法一直都不能正常工作,猜测是baseInfo是一个对象,如果是一个单属性值应该可以工作")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// baseInfo: {")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   get() {")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     console.log('get')")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     return this.$store.state.tabForm.baseInfo")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   },")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   set(value) {")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     console.log('set')")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     // this.$store.commit('tabForm/SET_BASE_INFO', value)")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     this.$store.dispatch('tabForm/changeForm', { key: 'baseInfo', value: value })")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   }")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// }")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mapState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("baseInfo")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tabForm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baseInfo\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("blockquote",[s("p",[t._v("TODO: 验证一下对象是否可以使用这种方式双向绑定表单")])])]),t._v(" "),s("blockquote"),t._v(" "),s("h4",{attrs:{id:"表单选项卡设计的自我挣扎"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表单选项卡设计的自我挣扎"}},[t._v("#")]),t._v(" 表单选项卡设计的自我挣扎")]),t._v(" "),s("pre",[s("code",[t._v(" 标签切换之前调用的钩子,用于校验表单 after success并发送action到vuex\n 使用vuex之后出现新的问题: 在父组件中使用$refs调用子组件中的校验isValidate后没有返回值,\n 父组件的before-leave hook需要一个返回值true/false来判断是否切换到下一个tab\n 下一个问题是: 设计上的问题,如果用户不填完第一个tab就不能切换到下个tab,这个设计不合理\n 解决的方式是:给用户一个提示数据校验失败,没保存,然后就切换到下一个\n 用户切换tab的时候提交到store并给用户提示,在用户保存的时候,校验所有的表单数据让用户一一检查\n 这样不好,如果用户只是想要提交其中一个tab中的数据呢?\n 最佳的处理方式还是每个表单设置一个提交按钮,这样用户可以单独校验和提交tab中的数据\n 或者用户切换时也会提交数据,\n想了想这样不行,用户切换的时候不适合提交数据,这样又回到了上个问题,\n用户切换的时候提交会卡在校验那里不通过就不能提交\n所以最佳的处理方法还是每个tab中添加一个提交按钮,用户填写一个就提交一个,\n提交之后返回用户提交成功与否信息,并返回数据库自动生成的记录id,并回显数据方便用户修改数据,\n为其他选项卡提交数据提供记录id\n")])]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/macheng2017/review-vue/commit/7998f5ecc67022b5c6359f59710e824ef9a1e57e",target:"_blank",rel:"noopener noreferrer"}},[t._v("refactor:Action 通过 store.dispatch 方法触发： · macheng2017/review-vue@7998f5e"),s("OutboundLink")],1)])]),t._v(" "),s("blockquote",[s("p",[t._v("参考:")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E7%B3%96%E6%9E%9C%E5%B1%8B",target:"_blank",rel:"noopener noreferrer"}},[t._v("糖果屋 - 维基百科，自由的百科全书"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://vuex.vuejs.org/zh/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vuex 是什么？ | Vuex"),s("OutboundLink")],1)])])])])}),[],!1,null,null,null);a.default=e.exports}}]);